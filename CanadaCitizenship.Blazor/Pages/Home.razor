@page "/"

<PageTitle>Home</PageTitle>

<RadzenLayout>
    <RadzenBody>
        <RadzenRow>
            <RadzenColumn Size="12" SizeMD="6">
                <RadzenFieldset AllowCollapse="true">
                    <HeaderTemplate><RadzenLabel>Profiles</RadzenLabel></HeaderTemplate>
                    <ChildContent>
                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12">
                                <RadzenFormField Text="Current Profile" Variant="Variant.Filled">
                                    <RadzenDropDown Data="@Profiles" TextProperty="Name" TValue="Profile" @bind-Value="@SelectedProfile">
                                    </RadzenDropDown>
                                </RadzenFormField>
                            </RadzenColumn>
                            <RadzenColumn Size="12">
                                <RadzenButton Click="@AddProfile">New Profile</RadzenButton>
                                <RadzenButton Visible="@(SelectedProfile is not null)" Click="@ProfileDelete">Delete Profile</RadzenButton>
                            </RadzenColumn>
                            <RadzenColumn Size="12">
                                <RadzenButton Click="@ImportProfiles">Import Profiles</RadzenButton>
                                <RadzenButton Click="@ExportProfiles">Save Profiles</RadzenButton>
                            </RadzenColumn>
                        </RadzenRow>
                    </ChildContent>
                </RadzenFieldset>
            </RadzenColumn>
            <RadzenColumn Size="12" SizeMD="6" Visible="@(SelectedProfile is not null)">
                <RadzenFieldset AllowCollapse="true">
                    <HeaderTemplate><RadzenLabel>Parameters</RadzenLabel></HeaderTemplate>
                    <ChildContent>
                        <RadzenRow Gap="1rem">
                            <RadzenColumn Size="12">
                                <RadzenRow>
                                    <RadzenColumn Size="12" SizeSM="6">
                                        <RadzenFormField Text="First Entry" Variant="Variant.Filled">
                                            <RadzenDatePicker DateFormat="d" @bind-Value="@SelectedProfile!.TemporaryDate" TValue="DateTime?"></RadzenDatePicker>
                                        </RadzenFormField>
                                    </RadzenColumn>
                                    <RadzenColumn Size="12" SizeSM="6">
                                        <RadzenFormField Text="Permanent Residency" Variant="Variant.Filled">
                                            <RadzenDatePicker DateFormat="d" @bind-Value="@SelectedProfile!.PRDate" TValue="DateTime?"></RadzenDatePicker>
                                        </RadzenFormField>
                                    </RadzenColumn>
                                </RadzenRow>
                            </RadzenColumn>
                            <RadzenColumn Size="12">
                                <RadzenButton ButtonStyle="ButtonStyle.Success" Icon="add_circle_outline" Text="Add Period" Click="@InsertRow" />
                                <RadzenDataGrid @ref="outOfCountryDataGrid" TItem="Period" Data="@SelectedProfile?.OutOfCountry" RowUpdate="@OnUpdateRow" RowCreate="@OnCreateRow">
                                    <Columns>
                                        <RadzenDataGridColumn Title="Begin" Property="Begin" FormatString="{0:d}">
                                            <EditTemplate Context="period">
                                                <RadzenDatePicker @bind-Value="period.Begin" DateFormat="d" Style="width:100%; display: block;" />
                                            </EditTemplate>
                                        </RadzenDataGridColumn>
                                        <RadzenDataGridColumn Title="End" Property="End" FormatString="{0:d}">
                                            <EditTemplate Context="period">
                                                <RadzenDatePicker @bind-Value="period.End" DateFormat="d" Style="width:100%; display: block;" />
                                            </EditTemplate>
                                        </RadzenDataGridColumn>
                                        <RadzenDataGridColumn Frozen="true" FrozenPosition="FrozenColumnPosition.Right" Width="160px" Title="Actions">
                                            <Template Context="period">
                                                <RadzenButton Icon="edit" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@(args => EditRow(period))" @onclick:stopPropagation="true">
                                                </RadzenButton>
                                                <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="delete" Variant="Variant.Flat" Shade="Shade.Lighter" Size="ButtonSize.Medium" class="my-1 ms-1" Click="@(args => DeleteRow(period))" @onclick:stopPropagation="true">
                                                </RadzenButton>
                                            </Template>
                                            <EditTemplate Context="period">
                                                <RadzenButton Icon="check" ButtonStyle="ButtonStyle.Success" Variant="Variant.Flat" Size="ButtonSize.Medium" Click="@((args) => SaveRow(period))" aria-label="Save">
                                                </RadzenButton>
                                                <RadzenButton Icon="close" ButtonStyle="ButtonStyle.Light" Variant="Variant.Flat" Size="ButtonSize.Medium" class="my-1 ms-1" Click="@((args) => CancelEdit(period))" aria-label="Cancel">
                                                </RadzenButton>
                                                <RadzenButton ButtonStyle="ButtonStyle.Danger" Icon="delete" Variant="Variant.Flat" Shade="Shade.Lighter" Size="ButtonSize.Medium" class="my-1 ms-1" Click="@(args => DeleteRow(period))" aria-label="Delete">
                                                </RadzenButton>
                                            </EditTemplate>
                                        </RadzenDataGridColumn>
                                    </Columns>
                                </RadzenDataGrid>
                            </RadzenColumn>
                        </RadzenRow>
                    </ChildContent>
                </RadzenFieldset>
            </RadzenColumn>
        </RadzenRow>
        <RadzenRow Visible="@(Result is not null)">
            <RadzenColumn Size="12">
                <RadzenFieldset AllowCollapse="true">
                    <HeaderTemplate><RadzenLabel>Result</RadzenLabel></HeaderTemplate>
                    <ChildContent>
                        <RadzenColumn Size="12">
                            <RadzenLabel>@string.Format(Messages.BeginTemporaryFormat, Result!.StartTemporary)</RadzenLabel>
                        </RadzenColumn>
                        <RadzenColumn Size="12">
                            <RadzenLabel>@string.Format(Messages.TotalTemporaryFormat, Result!.TemporaryDays)</RadzenLabel>
                        </RadzenColumn>
                        <RadzenColumn Size="12">
                            <RadzenLabel>@string.Format(Messages.TotalPRFormat, Result!.PRDays)</RadzenLabel>
                        </RadzenColumn>
                        <RadzenColumn Size="12">
                            <RadzenLabel>@string.Format(Messages.RemainingFormat, Result!.RemainingDays)</RadzenLabel>
                        </RadzenColumn>
                        <RadzenColumn Size="12">
                            <RadzenLabel>@string.Format(Messages.ProjectedApplyDateFormat, Result!.ProjectedDate)</RadzenLabel>
                        </RadzenColumn>
                    </ChildContent>
                </RadzenFieldset>
            </RadzenColumn>
        </RadzenRow>
    </RadzenBody>
</RadzenLayout>

